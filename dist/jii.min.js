/*! Jii - v0.1.10 - 2012-11-07
* http://goliatone.github.com/jii/
* Copyright (c) 2012 goliatone;
 Licensed MIT, GPL */
var VERSION = "0.1.10";
var jii = (function(namespace){

var VERSION="0.1.10",jii=function(e){var t=function(){this.version="0.1.0"};t.utils={createObject:function(e){var t;return t=function(){},t.prototype=e,new t},isEmpty:function(e){if(!e)return!0;if(typeof e=="string")return e===""?!0:!1;if(e.hasOwnProperty("length")&&e.length===0)return!0;var t;for(t in e)if(e.hasOwnProperty(t))return!1;return!0},fixArguments:function(e){var t=Array.prototype.splice.call(e,0);return!t[1]&&this.isArray(t[0])&&t.length===1?t[0]:t},hasAttributes:function(e){var t=Array.prototype.splice.call(arguments,1);t=this.fixArguments(t);for(var n in t)if(!(t[n]in e))return!1;return!0},isFunc:function(e,t){return t?t in e&&typeof e[t]=="function":typeof e=="function"},isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"},getKeys:function(e){if(typeof e!="object")return null;var t=[],n;for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t},getKeysAll:function(e){if(typeof e!="object")return null;var t={},n,r=0;for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&e[n]!==null&&typeof e[n]=="object"&&!this.isArray(e[n])?t[n]=this.getKeysAll(e[n]):Object.prototype.hasOwnProperty.call(e,n)&&(t[r++]=n);return t},result:function(e,t){if(e==null)return null;var n=e[t];return this.isFunc(n)?n.call(e):n},capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},map:function(e,t,n){var r=e.length;if(typeof t!="function")throw new TypeError(typeof t);var i=new Array(r);for(var s=0;s<r;s++)s in e&&(i[s]=t.call(n||this,e[s],s,e));return i},merge:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},intersect:function(e,t){return e.filter(function(e){return t.indexOf(e)!==-1})},firstToLowerCase:function(e){return e.charAt(0).toLowerCase()+e.slice(1)},ensureNamespace:function(e,n){var r;n=n||t,e=e.split(".");while(r=e.shift())typeof n[r]=="undefined"&&(n[r]={}),n=n[r];return n},resolvePropertyChain:function(e,t){!t&&typeof e=="string"&&(t=e,e=window),typeof t=="string"&&(t=t.split("."));var n=t.length,r=0,i="";for(;r<n;r++){i=t[r];if(!e.hasOwnProperty(i))return null;e=e[i]}return e},argumentNames:function(e){var t=e.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return t.length===1&&!t[0]?[]:t},truncate:function(e,t,n){if(typeof e=="undefined")return"";if(!e)return"";isNaN(t)&&(t=50),typeof n=="undefined"&&(n="..."),t-=n.length;var r=e;return r.length>t&&(r=r.substr(0,t),/[^\s]/.test(e.charAt(t))&&(r=r.replace(/\w+$|\s+$/,"")),r+=n),r}},function(e,t,n){var r=Array.prototype.splice,i=function(e,n){n=n||i,typeof n=="string"&&(n=t[n]);var s=function(){"init"in this&&this.init.apply(this,arguments)};s.prototype.init=function(){};if(n){for(var o in n)n.hasOwnProperty(o)&&(s[o]=i.clone(n[o]));for(o in n.prototype)n.prototype.hasOwnProperty(o)&&(s.prototype[o]=i.clone(n.prototype[o]));var u=function(){this.ctor=this.constructor=s};u.prototype=n.prototype,s.prototype=new u,s.prototype._super=n.prototype}return s.extend=function(e,t){var n;arguments.length>2?(t=e,n=Array.prototype.splice.call(arguments,0)):n=[e],t=t||s;var r=function(){var n=e.extended;for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n&&n.call(t,t)},i=0,o=n.length;for(;i<o;i++)r(n[i]);return t},s.include=function(){var e=function(e){var t=e.included;for(var n in e)e.hasOwnProperty(n)&&(s.fn[n]=e[n]);t&&t.call(s.fn,s.fn)},t=0,n=arguments.length;for(;t<n;t++)e(arguments[t]);return s},s.proxy=function(e){var t=r.call(arguments,1),n=this;return function(){var i=r.call(arguments,0);return e.apply(n,t.concat(i))}},s.fn=s.prototype,s.fn.parent=n,s.fn.proxy=s.proxy,s.prototype.__name__=s.__name__=e,s.prototype.__class__=s,t[e]=s,s};i.__name__="Module",i.__version__="0.0.1",i.decorator=function(e){var t=this,n=function(){};return n.prototype.decorate=function(){var t=0,n=arguments.length;for(;t<n;t++)e(arguments[t],this)},n.prototype.owner=t,new n(t)},i.override=function(e,t,n){e.parent=e.parent||{},e.parent[t]=e[t],e[t]=n},i.clone=function(t){return typeof t=="function"?t:typeof t!="object"?t:e.isArray(t)?e.extend([],t):e.extend({},t)},i.namespace=function(e){return t=e||t,t.hasOwnProperty(n)||(t[n]=i),t},t=t||this,n=n||"Module",t[n]=i}(jQuery,t,"Module"),function(e,t,n){function i(e,t,n){var r,i,s;for(i=0,s=e.length;i<s;i++){r=e[i];if(!r)continue;n.event=r,n.target=r.target;if(!r.callback.apply(r.scope,t))break}}var r=e[n],s=[].slice,o={subscribe:function(e,t,n,r){var i=this._callbacks||(this._callbacks={}),s=i[e]||(i[e]=[]),o={};return o.topic=e,o.callback=t,o.scope=n||this,o.target=this,s.push(o),this},subscribers:function(e){return this._callbacks.hasOwnProperty(e)&&this._callbacks[e].length>0},publish:function(e,t){var n=s.call(arguments,1);t=t||{},n.push(t);var r,o,u;return(o=this._callbacks)?!(r=o[e])&&!o.all?this:((u=o.all)&&i.call(this,u,s.call(arguments,0),t),r&&i.call(this,r,n,t),this):this},unsubscribe:function(e,t){var n,r,i,s;if(!(r=this._callbacks))return this;if(!(n=r[e]))return this;for(i=0,s=n.length;i<s;i++)n[i].callback===t&&n.splice(i,1);return this}},u={mixins:{pubsub:o}},a=r(t).include(o).extend(u);e=e||this,t=t||"PubSub",e[t]=a}(t,"PubSub","Module"),function(e,t,n){var r=e[n],i=function(){var e="",t=!0,n=function(e,n){e[n]=function(){if(!t)return;e.log(n),console[n].apply(console,arguments)}},r=function(){var e=this.d||(this.d=new Date);return e.getHours()+":"+e.getMinutes()+":"+e.getMilliseconds()},i={enable:function(e){return typeof e=="undefined"&&(e=!t),t=e,this},label:function(t){return t&&(e=t),this},log:function(){console.log("proto ",this);if(!t)return;var n="[ MSG: "+e+r()+" ]",i=Array.prototype.splice.call(arguments,0);return console.log.apply(console,[n].concat(i)),this}},s=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","markTimeline","profile","profileEnd","markTimeline","table","time","timeEnd","timeStamp","trace","warn"];for(var o=0;o<s.length;o++)n(i,s[o]);return i}(),s=e.PubSub.mixins.pubsub,o=r(t).include(s);o.log=i.log,o.logger=i,o.prototype.logger=i,o.prototype.log=o.fn.logger.log,e[t]=o}(t,"BaseModule","Module"),function(e,t,n){var r=e[n],i=r(t,"BaseModule"),s=function(e){var t={};t.create={url:"/api/{modelId}/",type:"POST",data:"toJSON"},t.read={url:"/api/{modelId}/{id}",type:"GET",data:null},t.update={url:"/api/{modelId}/{id}",type:"PUT",data:"toJSON"},t.destroy={url:"/api/{modelId}/{id}",type:"DELETE",data:null},t.compile=function(n,r){var i=t[n],s=$.extend({},i);return s.data&&(s.data=e.buildPayload(s.data,r)),s.url=e.buildUrl(s.url,r,e),s},e.actionMap=t},o=function(e,t,n,r){var i=e.actionMap.compile(t,n),s={url:i.url,type:i.type,dataType:"json",contentType:"application/json",data:i.data,dataFilter:function(e,t){return/\S/.test(e)?e:undefined},error:e.proxy(e.onError,t,n,r),success:e.proxy(e.onSuccess,t,n,r)};return s};i.prototype.actionMap={},i.prototype.init=function(){s(this)},i.prototype.buildPayload=function(e,t){return JSON.stringify(t[e]())},i.prototype.buildUrl=function(e,t,n){return this.parseUrl(e,t,n)},i.prototype.parseUrl=function(e,t,n){function r(e,r,i,s,o,u){var a=r in t?t[r]:"";return i&&(typeof a[s]=="function"?a=a[s]():typeof n[s]=="function"&&(a=n[s](a))),a}return e.replace(/\{(\w+)\}(\.(\w+))?/g,r)},i.prototype.service=function(e,t,n){var r=o(this,e,t,n);console.log(r),n&&n.settings&&(r=$.merge(r,n.settings)),console.log(r),$.ajax(r)},i.prototype.onSuccess=function(e,t,n,r,i,s){this.publish(e+":success",r,t,s,i),n&&n.onSuccess&&n.onSuccess(r,t,s,i)},i.prototype.onError=function(e,t,n,r,i,s){this.publish(e+":error",t,r,i),n&&n.onError&&n.onError(t,s,r,i)},i.prototype.create=function(e,t){return this.service("create",e,t)},i.prototype.read=function(e,t){return this.service("read",e,t)},i.prototype.update=function(e,t){return this.service("update",e,t)},i.prototype.destroy=function(e,t){return this.service("destroy",e,t)},i.prototype.handle302=function(){console.log("We got an 404")},e[t]=i}(t,"REST","Module"),function(e,n,r,i){var s=e[r],o=Object.create||function(e){var t;return t=function(){},t.prototype=e,new t},u=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a=function(e){if(!e)return!0;if(typeof e=="string")return e===""?!0:!1;if(e.hasOwnProperty("length")&&e.length===0)return!0;var t;for(t in e)if(e.hasOwnProperty(t))return!1;return!0},f=function(e){var t=Array.prototype.slice(arguments,1);for(var n in e)if(!u(e,n))return!1;return!0},l=function(e){return typeof e=="function"},c=function(e){return Object.prototype.toString.call(e)==="[object Array]"},h=function(e){if(typeof e!="object")return null;var t=[],n;for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t},p=function(e,t){if(e==null)return null;var n=e[t];return l(n)?n.call(e):n},d=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},v=function(e){var t=this.length;if(typeof e!="function")throw new TypeError;var n=new Array(t),r=arguments[1];for(var i=0;i<t;i++)i in this&&(n[i]=e.call(r,this[i],i,this));return n},m=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},g=function(e,t){e.filter(function(e){return t.indexOf(e)!==-1})},y=function(e){return e.charAt(0).toLowerCase()+e.slice(1)},b=s(n,"BaseModule").extend({records:{},grecords:{},attributes:[],extended:function(e){e.dispacher=new e,e.reset()},configure:function(e){u(e,"attributes")&&this.extend(e.attributes,this.attributes),this.fk="id"},clonesArray:function(e){var t,n=0,r=e.length,i=[];for(;n<r;n++)t=e[n],i.push(t.clone());return i},makeGid:function(){return"xxxxxxxx-xxxx-xxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e==="x"?t:t&3|8;return n.toString(16)}).toUpperCase()},isGid:function(e){return a(e)?!1:(e=e.replace(/[A-Z\d]/g,function(){return 0}),e==="00000000-0000-0000-0000-000000000000")},reset:function(e){this.records={},this.grecords={},this.attributes=[]},add:function(e,t){t=t||{silent:!0};var n=c(e)?e.slice():[e],r=0,i=n.length,s;for(;r<i;r++)n[r]=this._prepareModel(n[r],t);r=0,i=n.length;for(;r<i;r++){e=n[r],s=this.has(e)&&this.get(e);if(s){t.merge&&s&&s.load(e),n.splice(r,1),--r,--i;continue}e.subscribe("all",this._handleModel,this,t),this.grecords[e.gid]=e,e.has("id")&&(this.records[e.id]=e)}return e},_prepareModel:function(e,t){if(e instanceof b)return e;t=t||{};var n=new this.prototype.__class__(e,t);return n},get:function(e){e=this.ensureId(e);if(!this.has(e))return null;var t;return(t=this.records[e])?t:this.grecords[e]},ensureId:function(e,t){if(typeof e=="object")if(u(e,"id"))e=e.id;else{if(!u(e,"gid")||!!t)return null;e=e.gid}return e},has:function(e){return e?(e=this.ensureId(e),u(this.records,e)||u(this.grecords,e)):!1},count:function(e){var t=0,n,r;r=e?this.grecords:this.records;for(n in r)r.hasOwnProperty(n)&&t++;return t},remove:function(e){if(!this.has(e))return null;var t=this.get(e);return t.unsubscribe("all",this.proxy(this._handleModel)),delete this.records[t.id],delete this.grecords[t.gid],t},_handleModel:function(e,t){switch(e){case"create":break;case"remove":break;case"destroy":this.remove(t.target.id)}},each:function(e,t){var n=this.all(),r=[],i,s,o=0;for(i in n)n.hasOwnProperty(i)&&(s=n[i],t=t||s,r.push(e.call(t,s,o++,n)));return r},all:function(){return this.clonesArray(this.recordsValues())},first:function(){var e=this.recordsValues()[0];return e?e.clone():0},last:function(){var e=this.recordsValues(),t=e[e.length-1];return t?t.clone():void 0},toJSON:function(){return this.recordsValues()},fromJSON:function(e){if(!e)return null;console.log("FROM FUCKING JSON");if(typeof e=="string"){console.log(e);try{e=JSON.parse(e)}catch(t){console.log("Error! ",e)}}if(c(e)){var n=[],r=0,i=e.length,s;for(;r<i;r++)s=e[r],n.push(new this(s,{skipSync:!0}));return n}return[new this(e,{skipSync:!0})]},fromForm:function(e){var t=new this;return t.fromForm(e)},recordsValues:function(){var e,t,n=[],r=this.records;for(e in r)r.hasOwnProperty(e)&&(t=r[e],n.push(t));return n}}).include({errors:{},validators:{},scenario:null,init:function(e,t){this.modelName=d(this.__name__),this.modelId=y(this.__name__),this.clearErrors(),e&&this.load(e,t),console.log("CREATE MODEL, ",this.gid),this.gid=this.ctor.makeGid(),this.ctor.add(this)},validate:function(e,t){t=t||{},t.clearErrors&&this.clearErrors();var n,r,i;n=this.getValidators();for(i in n)n.hasOwnProperty(i)&&(r=n[i],r.validate(this,e));return!this.hasErrors()},getValidators:function(e){this.getValidatorList();var t=[],n,r=this.getScenario();for(n in t)t.hasOwnProperty(n)&&(n=t[n],n.applyTo(r)&&(!e||n.validatesAttribute(e))&&t.push(n));return t},getValidatorList:function(){return this.validators||(this.validators=this.createValidators())},createValidators:function(){var e={};for(var t in this.rules)this.rules.hasOwnProperty(t)&&(t=this.rules[t],f(t,"name","attribute")&&(e[t.attribute]=t));return e},addError:function(e,t){var n=this.errors[e]||(this.errors[e]=[]);n.push(t)},addErrors:function(e){var t,n;for(n in e)e.hasOwnProperty(n)&&(t=e[n],c(t)?this.addErrors(t):this.addError(n,t))},clearErrors:function(e){e&&e in this.errors?delete this.errors[e]:this.errors={}},hasError:function(e){return this.errors.hasOwnProperty(e)},hasErrors:function(e){return e?this.hasError(e):a(this.errors)},getErrors:function(e){var t;return e?t=(this.errors[e]||[]).concat():t=m({},this.errors),t},getError:function(e){return this.hasError(e)?this.errors[e][0]:void 0},load:function(e){var t,n,r;for(t in e)e.hasOwnProperty(t)&&(n=e[t],typeof n=="object"?this.load(n):l(this[t])?this[t](n):this[t]=n);return this},restore:function(){var e=this.constructor.findByGid(this.gid);return this.load(e.getAttributes()),e},get:function(e){return this[e]},set:function(e,t,n){var r=this[e];return this[e]=t,(!n||!n.silent)&&this.publish("update."+e,{old:r,value:t},n),this},has:function(e){return this.hasOwnProperty(e)},setScenario:function(e){if(!e||e===this.scenario)return;return this.scenario=e,this},getScenario:function(){return this.scenario},duplicate:function(e){var t=new this.constructor(this.getAttributes());return e===!1?t.gid=this.gid:delete t.id,t},clone:function(){return o(this)},hasAttribute:function(e){return this.getAttributeNames().indexOf(e)!==-1},getAttributeNames:function(){return this.constructor.attributes.concat()},getAttributes:function(e){var t,n=this.getAttributeNames();e&&c(e)&&(n=g(n,e));var r=0,i=n.length,s={};for(;r<i;r++)t=n[r],t in this&&(s[t]=p(this,t));return this.id&&(s.id=this.id),s},updateAttribute:function(e,t,n){var r=this[e];return this[e]=t,this.publish("update."+e,{old:r,value:t},n),this.save(n)},updateAttributes:function(e,t){var n=this.getAttributes();return this.load(e),this.publish("update.attributes",{old:n,values:e},t),this.save(t)},isNewRecord:function(){return!this.isRecord()},isEqual:function(e){return e?e.constructor!==this.constructor?!1:e.gid!==this.gid?!1:e.id!==this.id?!1:!0:!1},isValid:function(){return this.validate()},isInvalid:function(){return!this.validate()},isRecord:function(){return this.id&&this.id in this.constructor.records},toString:function(){return"["+this.__name__+" => "+" ]"},toJSONString:function(){return JSON.stringify(this.getAttributes())},toJSON:function(){return this.getAttributes()},fromJSON:function(e){return this.load(e)}});b.prototype.metadata=function(e){},b.prototype.fromForm=function(e,t){var n=$(e).serializeArray(),r=0,i=n.length,s,o,u={};t=t||new RegExp("(^"+this.modelName+"\\[)(\\w+)(\\]$)");for(;r<i;r++)o=n[r],s=o.name.replace(t,"$2"),u[o.name]=o.value;return this.load(u),this};var w=s("ActiveRecord",b).extend({extended:function(){this.stores=[]},ensureDefaultOptions:function(e){return e=e||{},l(e,"onError")||(e.onError=this.proxy(this.onError)),e},onError:function(e,t,n,r){this.log(this.__name__+" error: "+t," status ",r)},getService:function(){return this._service||this.setService(new t.REST),this._service},setService:function(e){return this._service=e,this},service:function(e,t,n){n=this.ensureDefaultOptions(n),this.getService().service(e,t,n)},update:function(e,t,n){var r=this.find(e);return r?(r.updateAttributes(t,n),r):null},create:function(e,t){t=this.ensureDefaultOptions(t);var n=new this(e);return t.skipSync=!0,n.save(t)},load:function(e){return new this(e)},destroy:function(e,t){var n=this.find(e);return n&&n.destroy(t),n},change:function(){},fetch:function(e,t){t=this.ensureDefaultOptions(t);var n=new this;e&&(n.id=e);var r=this;t.onSuccess=function(e){console.log("on fetch success ",arguments),r.fromJSON(e)},this.service("read",n,t)},find:function(e){var t=this.records[e];return!t&&this.isGid(e)?this.findByGid(e):t?t.clone():!1},findByPk:function(e){var t=this.records[e];return t?t.clone():!1},findByGid:function(e){var t=this.grecords[e];return t?t.clone():!1},exists:function(e){return this.findByPk(e)!==!1},reload:function(e,t){t=t||{},t.clear&&this.reset();var n=this.fromJSON(e);c(n)||(n=[n]);var r,i=0,s=n.length;for(;i<s;i++)r=n[i],r.id&&(this.records[r.id]=r),this.grecords[r.gid]=r;return this.publish("reload",this.clonesArray(n)),this},select:function(e){var t=function(){var t=this.records,n,r=[];for(var i in t)t.hasOwnProperty(i)&&(n=t[i],e(n)&&r.push(n));return r}.call(this);return this.clonesArray(t)},findByAttribute:function(e,t,n){var r=n?this.grecords:this.records,i,s,o;for(s in r)if(r.hasOwnProperty(s)){i=r[s],o=p(i,e);if(o===t)return i.clone()}return null},findAllByAttribute:function(e,t,n){return this.select(function(n){var r=p(n,e);return r===t})},deleteAll:function(){var e=this.records,t,n,r=[];for(t in e)e.hasOwnProperty(t)&&(n=e[t],r.push(delete this.records[t]));return r},destroyAll:function(){var e=this.records,t,n,r=[];for(t in e)e.hasOwnProperty(t)&&(n=e[t],r.push(this.records[t].destroy()));return r}}).include({service:function(){this.ctor.service.apply(this.ctor,arguments)},refresh:function(){},fetch:function(e){e=e||{};var t=this,n=e.onSuccess;return e.onSuccess=function(r,i,s){t.load(r),n&&n(t,r,e)},this.service("read",this,e),this},save:function(e){e=e||{},console.log("=============== SAVE"),e.validate!==!1&&this.isInvalid()&&this.publish("error",e),this.publish("beforeSave");var t=this.isNewRecord()?"create":"update";t==="update"&&(e.skipSync=!0);var n=this[t](e);return this.publish("save",e),n},create:function(e){e=e||{},this.publish("beforeCreate",e);var t=this.duplicate(!1);this.has("id")&&(this.constructor.records[this.id]=t),this.constructor.grecords[this.gid]=t;var n=t.clone();return n.publish("create",e),console.log("::::::::::::::::::::::::::::::: ",arguments.callee.caller),e.skipSync&&this.service("create",this,e),this.setScenario("update"),n},update:function(e){if(this.isNewRecord()){console.log("JII","Cannot update record, is new.");return}e=e||{},this.publish("beforeUpdate",e);var t=this.constructor.records[this.id];t.load(this.getAttributes());var n=t.clone();return e.skipSync&&this.service("update",this,e),this.publish("update",e),n},destroy:function(e){e=e||{},this.publish("beforeDestroy",e);if(e.skipDestroy)return this;var t=this,n=e.onSuccess;return e.onSuccess=function(r){n&&n(t,r,e)},this.service("destroy",this,e),this.publish("destroy",e),this.destroyed=!0,this}});e[n]=b}(t,"Model","Module","PubSub"),function(e,t,n){var r=e[n],i={create:function(e,t){t(!0)},destroy:function(e,t){t(!0)},read:function(e){e([])},update:function(e,t){t(!0)}},s=function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},o=function(e){var t=localStorage[e];return t?JSON.parse(t):[]},u=function(e,t){localStorage.setItem(t,JSON.stringify(e))},a=function(e,t){var n=o(t);s(n,e)===-1&&(n.push(e),u(n,t))},f=function(e,t){var n=o(t),r=s(n,e);r>-1&&(n.splice(r,1),u(n,t))},l=function(e,t){var n=e.toJSON();localStorage.setItem(e.gid,JSON.stringify(n)),a(e.gid,t)},c=function(e){return Object.prototype.toString.call(e)==="[object Array]"},h=r(t,"BaseModule").include({init:function(t){this.modelModule=t,this.collectionId=t.__name__+"-collection"},makeStoreId:function(t){return t.__name__+"-collection"},create:function(t,n){if(c(t))for(var r=0,i=t.length;r<i;++r)l(t[r],this.collectionId);else l(t,this.collectionId);n&&n(!0)},destroy:function(e,t){if(e)localStorage.removeItem(e.gid),f(e.gid,this.collectionId);else{var n=o(this.collectionId);for(var r=0,i=n.length;r<i;r++)f(n[r],this.collectionId)}t&&t(!0)},read:function(e){var t=this.modelModule.each(function(e){return e.gid}),n=o(this.collectionId),r=[],i,u,a;for(var f=0,l=n.length;f<l;f++)a=n[f],s(t,a)===-1?(i=JSON.parse(localStorage[a]),u=new this.modelModule(i),u.gid=a):u=this.modelModule.findByGid(a),r.push(u);return e&&e(r),r},update:function(e,t){l(e,this.collectionId),t&&t(!0)}}),p=window.localStorage;e[t]=p?h:i}(t,"LocalStore","Module")}("jii");